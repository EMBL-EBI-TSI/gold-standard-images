{
  "variables": {
    "namespace": "ebi",
    "version": "0.1.0",
    "headless": "false",

    "username": "vagrant",
    "password": "vagrant",

    "server": "mirror.ox.ac.uk/sites/mirror.centos.org",
    "ks_server": "172.22.10.249/~luisg/ks",
    "iso": null,
    "os_name": "CentOS",
    "os_version": null,
    "iso_checksum": null
  },

  "builders": [{
    "type": "virtualbox-iso",
    "headless": "{{user `headless`}}",
    "guest_os_type": "RedHat_64",

    "iso_url": "http://{{user `server`}}/{{user `os_version`}}/isos/x86_64/{{user `iso`}}.iso",
    "iso_checksum_type": "sha256",
    "iso_checksum": "{{user `iso_checksum`}}",

    "guest_additions_path": "/tmp/VBoxGuestAdditions.iso",

    "ssh_username": "{{user `username`}}",
    "ssh_password": "{{user `password`}}",
    "shutdown_command": "echo '{{user `username`}}' | sudo -S shutdown -P now",
    "ssh_wait_timeout": "10000s",

    "disk_size": "5000",

    "http_directory": "",
    "boot_command": [
      "<tab> ks=http://{{user `ks_server`}}/ks.php?machine=vagrant selinux=0<enter><wait>"
    ],

    "vboxmanage": [
      [ "modifyvm", "{{.Name}}", "--memory", "512" ],
      [ "modifyvm", "{{.Name}}", "--cpus", "1" ]
    ]
  }],

  "post-processors": [{
    "output": "artifacts/{{user `os_name`}}-{{user `os_version`}}-v{{user `version`}}.box",
    "type": "vagrant"
  }],

  "provisioners": [
    {
      "type": "file",
      "source": "keys/vagrant.pub",
      "destination": "/tmp/vagrant.pub"
    },
    {
      "type": "shell",
      "execute_command": "echo '{{user `username`}}' | {{.Vars}} sudo -E -S sh '{{.Path}}'",
      "environment_vars": [
        "USER_SERVER={{user `server`}}",
        "USER_CENTOS={{user `os_version`}}"
      ],
      "scripts": [
        "scripts/base.sh",
        "scripts/vagrant.sh",
        "scripts/virtualbox.sh",
        "scripts/cleanup.sh"
        "scripts/zero.sh"
      ]
    }
  ]
}
